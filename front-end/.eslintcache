[{"/home/antreas/Hardeng/front-end/src/ChargingExperience.js":"1","/home/antreas/Hardeng/front-end/src/UserInfo.js":"2","/home/antreas/Hardeng/front-end/src/Payment.js":"3","/home/antreas/Hardeng/front-end/src/EditUserInfo.js":"4"},{"size":13476,"mtime":1615630939595,"results":"5","hashOfConfig":"6"},{"size":3348,"mtime":1615631086455,"results":"7","hashOfConfig":"6"},{"size":3632,"mtime":1615377178823,"results":"8","hashOfConfig":"6"},{"size":9048,"mtime":1615632226394,"results":"9","hashOfConfig":"6"},{"filePath":"10","messages":"11","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"12","usedDeprecatedRules":"13"},"hl5qnz",{"filePath":"14","messages":"15","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"16","messages":"17","errorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"18","messages":"19","errorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},"/home/antreas/Hardeng/front-end/src/ChargingExperience.js",["20"],"import React, { useState } from 'react';\nimport UserInfo from './UserInfo';\nimport Payment from './Payment';\nimport M from 'materialize-css';\nimport { MapContainer, TileLayer, Marker, Popup, useMapEvents } from 'react-leaflet'\nimport L from 'leaflet'\nimport { getStations, postInitiateSession, getDriverCars, getDriverPolicies, logSession } from './API';\nimport { FaCarBattery, FaCartPlus } from \"react-icons/fa\";\nimport 'leaflet/dist/leaflet.css';\nimport './ChargingExperience.css';\n\nimport image from './icons/ChargingExperience.jpg';\nimport icon from 'leaflet/dist/images/marker-icon.png';\nimport iconRetina from 'leaflet/dist/images/marker-icon-2x.png';\nimport iconShadow from 'leaflet/dist/images/marker-shadow.png';\nimport person from './icons/black-marker.png';\n\nvar locationIcon = L.icon({\n  iconUrl: person,\n  shadowUrl: iconShadow,\n  iconSize: [36, 36],\n  iconAnchor: [18, 36]\n});\n\nlet DefaultIcon = L.icon({\n  iconUrl: icon,\n  iconRetinaUrl: iconRetina,\n  shadowUrl: iconShadow,\n  iconSize: [24, 36],\n  iconAnchor: [12, 36]\n});\nL.Marker.prototype.options.icon = DefaultIcon;\n\nconst Athens = [37.983810, 23.727539];\nconst pricesHardcoded = [10, 20, 30, 40, 50, 60];\nconst vehiclesHardcoded = [\n  {BrandName:\"Honda Civic\", Model: \"e-soul\", CarID:1},\n  {BrandName:\"Renault Scenic\", Model:\"e-soul\", CarID:2}\n];\nconst stationsHardcoded = [\n  { position: [37.983810, 23.727539], label: \"Athens\", station_id: 1 },\n  { position: [40.629269, 22.947412], label: \"Thessaloniki\", station_id: 2 }\n];\nconst policiesHardcoded = [\n  {PricePolicyID: 1, KWh: 5, CostPerKWh: 200},\n  {PricePolicyID: 2, KWh: 6, CostPerKWh: 300}\n]\n\nfunction LocationMarker(props) {\n  const [position, setPosition] = useState(null)\n  const map = useMapEvents({\n    click() {\n      map.locate();\n    },\n\n    locationfound(e) {\n      setPosition(e.latlng);\n      props.setter(e.latlng);\n      map.flyTo(e.latlng, map.getZoom());\n    },\n  })\n\n  return position === null ? null : (\n    <Marker position={position} icon={locationIcon}>\n      <Popup>You are here</Popup>\n    </Marker>\n  )\n}\n\nclass ChargingExperience extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      driverKey: localStorage.getItem(\"driverKey\"),\n      driverID: localStorage.getItem(\"driverID\"),\n\n      stations: [],\n      prices: pricesHardcoded,\n      vehicles: vehiclesHardcoded,\n      policies: policiesHardcoded,\n      \n      currentPos: null,\n      \n      sessionStarted: false,\n      chosenIndex: null,\n      stationID: null,\n      vehicleID: null,\n      stationPointID: null,\n      pricePolicy: null,\n      pricePolicyID: null,\n      payment: null,\n      \n      session: {\n        startedOn: null,\n        finishedOn: null,\n        energyDelivered: null,\n        payment: null,\n        chargingPointId: null,\n        pricePolicyId: null,\n        carId: null,\n        driverId: null\n      },\n      \n      zoom: 10,\n      error: null,\n      sessionError: null\n    };\n\n    this.getDate = this.getDate.bind(this);\n    this.formatZero = this.formatZero.bind(this);\n    this.initiateSession = this.initiateSession.bind(this);\n    this.finishSession = this.finishSession.bind(this);\n    this.setPayment = this.setPayment.bind(this);\n    this.handleSelect = this.handleSelect.bind(this);\n    this.showMarkers = this.showMarkers.bind(this);\n    this.showOptions = this.showOptions.bind(this);\n    this.handleLocation = this.handleLocation.bind(this);\n  }\n\n  formatZero(xx) {\n    if(xx < 10) {\n      return '0' + xx;\n    }\n    else{\n      return xx;\n    }\n  }\n  getDate(){\n    var time = new Date();\n    \n    var year = time.getFullYear();\n    var month = this.formatZero(time.getMonth() + 1);\n    var day = this.formatZero(time.getDate());\n    var hour = this.formatZero(time.getHours());\n    var minute = this.formatZero(time.getMinutes());\n    var seconds = this.formatZero(time.getSeconds());\n\n    var ans = year + '-' + month + '-' + day + ' ' + hour + ':' + minute + ':' + seconds;\n\n    return ans;\n  }\n  finishSession(e, payment_type) {\n    e.preventDefault();\n\n    var newSession = this.state.session;\n    newSession.energyDelivered = this.state.payment / this.state.pricePolicy ;\n    newSession.finishedOn = this.getDate();\n    newSession.payment = payment_type;\n\n    console.log(newSession);\n\n    this.setState({\n      session: newSession\n    }, () => {\n      logSession(this.state.driverKey, this.state.session)\n        .then(res => {\n          window.location.reload();\n        })\n        .catch(err => {\n          if(err.response){\n            M.toast({html: 'LogSession Error ' + err.response.status, classes:\"purple darken-4 yellow-text\"});\n          }\n          else{\n            M.toast({html: 'LogSession Error undefined', classes:\"purple darken-4 yellow-text\"});\n          }\n        });\n    });\n  }\n  initiateSession(e){\n    e.preventDefault();\n\n    const station = this.state.stationID;\n    const vehicle = this.state.vehicleID;\n    const payment = this.state.payment;\n    const policy = this.state.pricePolicy;\n    var newError = null;\n\n    if(station === null || vehicle === null || payment === null || policy === null) {\n      newError = \"All fields required\";\n    }\n    else if(this.state.driverKey === null) {\n      newError = \"Not logged in\";\n    }\n    else {\n      postInitiateSession(this.state.driverKey, station)\n        .then(res => {\n          console.log(res);\n\n          var session = this.state.session;\n          session.startedOn = this.getDate();\n          session.chargingPointId = res.data;\n          session.carId = this.state.vehicleID;\n          //session.payment = this.state.payment;\n          session.pricePolicyId = this.state.pricePolicyID;\n          session.driverId = this.state.driverID;\n    \n          this.setState({\n            sessionError: null,\n            sessionStarted: true,\n            session: session,\n          });\n        })\n        .catch(err => {\n          if(err.response) {\n            newError = \"Error \" + err.response.status;\n          }\n          else{\n            console.log(err);\n          }\n        })\n    }\n\n    if(newError !== null){\n      this.setState({sessionError: newError});\n      M.toast({html: 'InitiateSession ' + newError, classes:\"purple darken-4 yellow-text\"});\n    }\n  }\n  setPayment(p){\n    var newSession = this.state.session;\n\n    newSession.payment = p;\n\n    this.setState({session: newSession});\n  }\n  showMarkers() {\n    var i = this.state.chosenIndex;\n\n    if (i === null) {\n      return (this.state.stations.map(({ position, label }, index) => <Marker key={index} value={label} position={position}></Marker>));\n    }\n\n    else {\n      var station = this.state.stations[i];\n      return (<Marker key={i} value={station.label} position={station.position}></Marker>);\n    }\n  }\n  showOptions() {\n    return (\n      this.state.stations.map(({ label, id}, index) => <option value={index}> {label} </option>)\n    );\n  }\n  handleSelect(e) {\n    if(e.target.name === \"stationID\"){\n      if(e.target.value === \"all\") {\n        this.setState({ chosenIndex: null, stationID: null });\n      }\n      else {\n        this.setState({ chosenIndex: e.target.value });\n        const s = this.state.stations;\n        const c = e.target.value;\n\n        this.setState({ stationID: s[c].station_id });\n        \n      }\n    }\n    else if(e.target.name === \"pricePolicyID\"){\n      const index = e.target.value;\n      this.setState({pricePolicyID: this.state.policies[index].PricePolicyID, pricePolicy: this.state.policies[index].CostPerKWh})\n    }\n    else {\n      this.setState({[e.target.name]: e.target.value});\n    }\n  }\n  handleLocation(latlng) {\n    this.setState({\n      currentPos: latlng\n    }, () => {\n      getStations(this.state.driverKey, latlng)\n        .then(res => { \n          console.log(res.data);\n          this.setState({ stations: res.data }) })\n        .catch(err => { \n          if(err.response){\n            this.setState({ error: err.response.status });\n            M.toast({html: 'GetStations Error ' + this.state.error, classes:\"purple darken-4 yellow-text\"});\n          }\n        })\n    });\n  }\n  componentDidMount() {\n    M.AutoInit();\n\n    // Fetch user's cars and price policies\n    if(this.state.driverKey !== null){\n      getDriverCars(this.state.driverKey, this.state.driverID)\n        .then(res => {this.setState({vehicles: res.data[\"Cars\"]})})\n        .catch(err => {\n          if(err.response){\n            M.toast({html: 'GetCars Error ' + err.response.status, classes:\"purple darken-4 yellow-text\"});\n          }\n          else{\n            M.toast({html: 'GetCars Error undefined', classes:\"purple darken-4 yellow-text\"});\n          }\n        })\n      \n      getDriverPolicies(this.state.driverKey, this.state.driverID)\n        .then(res => {this.setState({policies: res.data[\"PricePolicies\"]})})\n        .catch(err => {\n          if(err.response){\n            M.toast({html: 'GetPolicies Error ' + err.response.status, classes:\"purple darken-4 yellow-text\"});\n          }\n          else{\n            M.toast({html: 'GetPolicies Error undefined', classes:\"purple darken-4 yellow-text\"});\n          }\n        })\n    }\n  }\n\n  render() {\n    return (\n      <div \n      className=\"row\"\n      style={{ \n        backgroundImage: `url(${image})`,\n        backgroundRepeat: 'no-repeat',\n        height: '1000px',\n        backgroundAttachment: 'fixed',\n        backgroundSize: '100% 100%',}}\n      >\n        {false && <button onClick={e => {console.log(this.state)}}> State </button>}\n        <div className=\"col s2\">\n          <UserInfo />\n        </div>\n        <div className=\"col s10\">\n          <div className=\"card\">\n            <MapContainer\n              className='map'\n              center={Athens}\n              zoom={this.state.zoom}\n            >\n              <TileLayer\n                attribution='&copy; <a href=\"http://osm.org/copyright\">OpenStreetMap</a> contributors'\n                url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n              />\n              {this.showMarkers()}\n              <LocationMarker setter={this.handleLocation} />\n            </MapContainer>\n\n            <form onSubmit={this.initiateSession}>\n              <div className=\"\">\n                <select name=\"stationID\" className=\"browser-default\" onChange={this.handleSelect}>\n                  <option value=\"\" disabled selected>Choose station ...</option>\n                  <option value=\"all\">Show all stations</option>\n                  {this.state.stations.map(({label}, index) => <option value={index}> {label} </option>)}\n                </select>\n                <select name=\"payment\" className=\"browser-default\" onChange={this.handleSelect}>\n                  <option value=\"\" disabled selected>Payment amount</option>\n                  {this.state.prices.map(price => <option value={price}> {price} </option>)}\n                </select>\n                <select name=\"vehicleID\" className=\"browser-default\" onChange={this.handleSelect}>\n                  <option value=\"\" disabled selected>Choose car</option>\n                  {this.state.vehicles.map(({CarID, BrandName, Model}) => <option value={CarID}> {BrandName + ' ' + Model} </option>)}\n                </select>\n                <select name=\"pricePolicyID\" className=\"browser-default\" onChange={this.handleSelect}>\n                  <option value=\"\" disabled selected>Choose policy</option>\n                  {this.state.policies.map(({CostPerKWh}, index) => <option value={index}> {CostPerKWh + 'â‚¬ per KWh'} </option>)}\n                </select>\n                <div className=\"center-align\">\n                  <button\n                    className=\"btn-flat green-text\"\n                    type=\"submit\"\n                    >\n                    Initiate Session <FaCarBattery/> \n                  </button>\n                </div>\n              </div>\n            </form>\n\n            <div className=\"center-align\">\n              <Payment \n                disabled={!this.state.sessionStarted} \n                payment={this.state.payment}\n                doNext={(e, t) => this.finishSession(e, t)} \n              />\n            </div>\n            <div className=\"center-align\">\n              <button \n                blue-text\n                disabled={!this.state.sessionStarted} \n                className=\"btn-flat\"\n                onClick={e => {this.finishSession(e, 'unpaid')}}\n                >\n                Charge Tab <FaCartPlus/>\n              </button>\n            </div>\n            \n            {this.state.chosenIndex !== null && false && (\n              <table className=\"centered white\">\n              <thead>\n                <tr>\n                  <th>Location</th>\n                  <th>Condition</th>\n                  <th>Required Time</th>\n                </tr>\n              </thead>\n\n              <tbody>\n                <tr>\n                  <td>{this.state.stations[this.state.chosenIndex].label}</td>\n                  <td>{this.state.stations[this.state.chosenIndex].condition}</td>\n                  <td>{this.state.stations[this.state.chosenIndex].time}</td>\n                </tr>\n              </tbody>\n            </table>\n            )\n            }\n          </div>\n        </div>\n\n        {false &&<div className=\"fixed-action-btn\">\n          <button className=\"btn-floating tooltipped red pulse\" data-position=\"left\" data-tooltip=\"Click map to give location\">\n            !\n          </button>\n        </div>}\n      </div>\n    )\n  }\n}\n\nexport default ChargingExperience",["21","22"],"/home/antreas/Hardeng/front-end/src/UserInfo.js",[],"/home/antreas/Hardeng/front-end/src/Payment.js",["23","24","25"],"/home/antreas/Hardeng/front-end/src/EditUserInfo.js",["26","27","28","29","30"],{"ruleId":"31","severity":1,"message":"32","line":40,"column":7,"nodeType":"33","messageId":"34","endLine":40,"endColumn":24},{"ruleId":"35","replacedBy":"36"},{"ruleId":"37","replacedBy":"38"},{"ruleId":"31","severity":1,"message":"39","line":3,"column":10,"nodeType":"33","messageId":"34","endLine":3,"endColumn":17},{"ruleId":"31","severity":1,"message":"40","line":4,"column":26,"nodeType":"33","messageId":"34","endLine":4,"endColumn":30},{"ruleId":"31","severity":1,"message":"41","line":5,"column":22,"nodeType":"33","messageId":"34","endLine":5,"endColumn":29},{"ruleId":"31","severity":1,"message":"42","line":1,"column":17,"nodeType":"33","messageId":"34","endLine":1,"endColumn":25},{"ruleId":"31","severity":1,"message":"43","line":4,"column":13,"nodeType":"33","messageId":"34","endLine":4,"endColumn":18},{"ruleId":"31","severity":1,"message":"44","line":8,"column":7,"nodeType":"33","messageId":"34","endLine":8,"endColumn":23},{"ruleId":"45","severity":1,"message":"46","line":43,"column":29,"nodeType":"47","messageId":"48","endLine":43,"endColumn":31},{"ruleId":"31","severity":1,"message":"49","line":94,"column":11,"nodeType":"33","messageId":"34","endLine":94,"endColumn":20},"no-unused-vars","'stationsHardcoded' is assigned a value but never used.","Identifier","unusedVar","no-native-reassign",["50"],"no-negated-in-lhs",["51"],"'userPay' is defined but never used.","'Card' is defined but never used.","'Ewallet' is defined but never used.","'useState' is defined but never used.","'toast' is defined but never used.","'driversHardcoded' is assigned a value but never used.","eqeqeq","Expected '!==' and instead saw '!='.","BinaryExpression","unexpected","'instances' is assigned a value but never used.","no-global-assign","no-unsafe-negation"]